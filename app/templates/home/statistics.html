{% extends 'home/layout_statistics.html' %} {% block title %} Statistics {%
endblock title %}

<!-- Specific CSS goes HERE -->
{% block stylesheets %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/global.css') }}"
/>
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/statistics.css') }}"
/>
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/transition.css') }}"
/>
{% endblock stylesheets %} {% block content %}
<div class="main">
  <div class="cards">
    <!-- Card stats -->
    <div class="row">
      <div class="col-xl-3 col-md-6">
        <div class="card card-stats">
          <!-- Card body -->
          <div class="card-body">
            <div class="row">
              <div class="col">
                <h5 class="card-title text-uppercase text-muted mb-0">
                  Total distance
                </h5>
                <span class="h2 font-weight-bold mb-0">
                  {{ total_distance }} km</span
                >
              </div>
              <div class="col-auto">
                <div
                  class="icon icon-shape bg-gradient-red text-white rounded-circle shadow"
                >
                  <i class="ni ni-active-40"></i>
                </div>
              </div>
            </div>
            <p class="mt-3 mb-0 text-sm">
              <span class="text-success mr-2"
                ><i class="fa fa-arrow-up"></i> {{ month_distance }} km</span
              >
              <span class="text-nowrap">this month</span>
            </p>
          </div>
        </div>
      </div>
      <div class="col-xl-3 col-md-6">
        <div class="card card-stats">
          <!-- Card body -->
          <div class="card-body">
            <div class="row">
              <div class="col">
                <h5 class="card-title text-uppercase text-muted mb-0">
                  Longest run
                </h5>
                <span class="h2 font-weight-bold mb-0"
                  >{{ longest_run }} km</span
                >
              </div>
              <div class="col-auto">
                <div
                  class="icon icon-shape bg-gradient-orange text-white rounded-circle shadow"
                >
                  <i class="ni ni-chart-pie-35"></i>
                </div>
              </div>
            </div>
            <p class="mt-3 mb-0 text-sm">
              <span class="text-success mr-2"
                ><i class="fa fa-arrow-right"></i> {{ month_longest_run }}
                km</span
              >
              <span class="text-nowrap">this month</span>
            </p>
          </div>
        </div>
      </div>
      <div class="col-xl-3 col-md-6">
        <div class="card card-stats">
          <!-- Card body -->
          <div class="card-body">
            <div class="row">
              <div class="col">
                <h5 class="card-title text-uppercase text-muted mb-0">
                  Fastest pace
                </h5>
                <span class="h2 font-weight-bold mb-0">
                  {{ fastest_pace }} h/km</span
                >
              </div>
              <div class="col-auto">
                <div
                  class="icon icon-shape bg-gradient-green text-white rounded-circle shadow"
                >
                  <i class="ni ni-money-coins"></i>
                </div>
              </div>
            </div>
            <p class="mt-3 mb-0 text-sm">
              <span class="text-success mr-2"
                ><i class="fa fa-arrow-right"></i> {{ month_pace }} h/km</span
              >
              <span class="text-nowrap">this month</span>
            </p>
          </div>
        </div>
      </div>
      <div class="col-xl-3 col-md-6">
        <div class="card card-stats">
          <!-- Card body -->
          <div class="card-body">
            <div class="row">
              <div class="col">
                <h5 class="card-title text-uppercase text-muted mb-0">
                  Success rate
                </h5>
                <span class="h2 font-weight-bold mb-0">
                  {{ success_rate }}%</span
                >
              </div>
              <div class="col-auto">
                <div
                  class="icon icon-shape bg-gradient-info text-white rounded-circle shadow"
                >
                  <i class="ni ni-chart-bar-32"></i>
                </div>
              </div>
            </div>
            <p class="mt-3 mb-0 text-sm">
              <span class="text-success mr-2"
                ><i class="fa fa-arrow-right"></i> out of</span
              >
              <span class="text-nowrap">{{ total_run_num }} tries</span>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="graphs">
    <!-- Page content -->
    <div class="container-fluid mt--6">
      <div class="row">
        <div class="col-xl-8">
          <div class="card bg-default">
            <div class="card-header bg-transparent">
              <div class="row align-items-center">
                <div class="col">
                  <h6 class="text-light text-uppercase ls-1 mb-1">Overview</h6>
                  <h5 class="h3 text-white mb-0">Distance run (km)</h5>
                </div>
                <div class="col">
                  <ul class="nav nav-pills justify-content-end">
                    <li
                      class="nav-item mr-2 mr-md-0"
                      data-toggle="chart"
                      data-target="#chart-sales-dark"
                      data-update='{"data":{"datasets":[{"data":{{ six_month_distances|tojson }}}]}}'
                      data-prefix=""
                      data-suffix=" km"
                    >
                      <a
                        href="#"
                        class="nav-link py-2 px-3 active"
                        style="text-decoration: none"
                        data-toggle="tab"
                      >
                        <span class="d-none d-md-block">Distance</span>
                        <span class="d-md-none">s</span>
                      </a>
                    </li>
                    <li
                      class="nav-item"
                      data-toggle="chart"
                      data-target="#chart-sales-dark"
                      data-update='{"data":{"datasets":[{"data":{{ six_month_nums|tojson }}}]}}'
                      data-prefix=""
                      data-suffix=" runs"
                    >
                      <a
                        href="#"
                        class="nav-link py-2 px-3"
                        style="text-decoration: none"
                        data-toggle="tab"
                      >
                        <span class="d-none d-md-block">Run time</span>
                        <span class="d-md-none">T</span>
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="card-body">
              <!-- Chart -->
              <div class="chart">
                <!-- Chart wrapper -->
                <canvas id="chart-sales-dark" class="chart-canvas"></canvas>
              </div>
            </div>
          </div>
        </div>

        <div class="col-xl-4">
          <div class="card">
            <div class="card-header bg-transparent">
              <div class="row align-items-center">
                <div class="col">
                  <h6 class="text-uppercase text-muted ls-1 mb-1">
                    Performance
                  </h6>
                  <h5 class="h3 mb-0">Total calories</h5>
                </div>
              </div>
            </div>
            <div class="card-body">
              <!-- Chart -->
              <div class="chart">
                <canvas id="chart-bars" class="chart-canvas"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock content %}

<!-- Specific JS goes HERE -->
{% block javascripts %}
<script src="{{ url_for('static', filename='assets/vendor/chart.js/dist/Chart.min.js') }}"></script>
<script src="{{ url_for('static', filename='assets/vendor/chart.js/dist/Chart.extension.js') }}"></script>

<script>
    'use strict';

  var Charts = (function() {

    // Variable

    var $toggle = $('[data-toggle="chart"]');
    var mode = 'light';//(themeMode) ? themeMode : 'light';
    var fonts = {
      base: 'Open Sans'
    }

    // Colors
    var colors = {
      gray: {
        100: '#f6f9fc',
        200: '#e9ecef',
        300: '#dee2e6',
        400: '#ced4da',
        500: '#adb5bd',
        600: '#8898aa',
        700: '#525f7f',
        800: '#32325d',
        900: '#212529'
      },
      theme: {
        'default': '#172b4d',
        'primary': '#5e72e4',
        'secondary': '#f4f5f7',
        'info': '#11cdef',
        'success': '#2dce89',
        'danger': '#f5365c',
        'warning': '#fb6340'
      },
      black: '#12263F',
      white: '#FFFFFF',
      transparent: 'transparent',
    };


    // Methods

    // Chart.js global options
    function chartOptions() {

      // Options
      var options = {
        defaults: {
          global: {
            responsive: true,
            maintainAspectRatio: false,
            defaultColor: (mode == 'dark') ? colors.gray[700] : colors.gray[600],
            defaultFontColor: (mode == 'dark') ? colors.gray[700] : colors.gray[600],
            defaultFontFamily: fonts.base,
            defaultFontSize: 13,
            layout: {
              padding: 0
            },
            legend: {
              display: false,
              position: 'bottom',
              labels: {
                usePointStyle: true,
                padding: 16
              }
            },
            elements: {
              point: {
                radius: 0,
                backgroundColor: colors.theme['primary']
              },
              line: {
                tension: .4,
                borderWidth: 4,
                borderColor: colors.theme['primary'],
                backgroundColor: colors.transparent,
                borderCapStyle: 'rounded'
              },
              rectangle: {
                backgroundColor: colors.theme['warning']
              },
              arc: {
                backgroundColor: colors.theme['primary'],
                borderColor: (mode == 'dark') ? colors.gray[800] : colors.white,
                borderWidth: 4
              }
            },
            tooltips: {
              enabled: true,
              mode: 'index',
              intersect: false,
            }
          },
          doughnut: {
            cutoutPercentage: 83,
            legendCallback: function(chart) {
              var data = chart.data;
              var content = '';

              data.labels.forEach(function(label, index) {
                var bgColor = data.datasets[0].backgroundColor[index];

                content += '<span class="chart-legend-item">';
                content += '<i class="chart-legend-indicator" style="background-color: ' + bgColor + '"></i>';
                content += label;
                content += '</span>';
              });

              return content;
            }
          }
        }
      }

      // yAxes
      Chart.scaleService.updateScaleDefaults('linear', {
        gridLines: {
          borderDash: [2],
          borderDashOffset: [2],
          color: (mode == 'dark') ? colors.gray[900] : colors.gray[300],
          drawBorder: false,
          drawTicks: false,
          drawOnChartArea: true,
          zeroLineWidth: 0,
          zeroLineColor: 'rgba(0,0,0,0)',
          zeroLineBorderDash: [2],
          zeroLineBorderDashOffset: [2]
        },
        ticks: {
          beginAtZero: true,
          padding: 10,
          callback: function(value) {
            if (!(value % 10)) {
              return value
            }
          }
        }
      });

      // xAxes
      Chart.scaleService.updateScaleDefaults('category', {
        gridLines: {
          drawBorder: false,
          drawOnChartArea: false,
          drawTicks: false
        },
        ticks: {
          padding: 20
        },
        maxBarThickness: 10
      });

      return options;

    }

    // Parse global options
    function parseOptions(parent, options) {
      for (var item in options) {
        if (typeof options[item] !== 'object') {
          parent[item] = options[item];
        } else {
          parseOptions(parent[item], options[item]);
        }
      }
    }

    // Push options
    function pushOptions(parent, options) {
      for (var item in options) {
        if (Array.isArray(options[item])) {
          options[item].forEach(function(data) {
            parent[item].push(data);
          });
        } else {
          pushOptions(parent[item], options[item]);
        }
      }
    }

    // Pop options
    function popOptions(parent, options) {
      for (var item in options) {
        if (Array.isArray(options[item])) {
          options[item].forEach(function(data) {
            parent[item].pop();
          });
        } else {
          popOptions(parent[item], options[item]);
        }
      }
    }

    // Toggle options
    function toggleOptions(elem) {
      var options = elem.data('add');
      var $target = $(elem.data('target'));
      var $chart = $target.data('chart');

      if (elem.is(':checked')) {

        // Add options
        pushOptions($chart, options);

        // Update chart
        $chart.update();
      } else {

        // Remove options
        popOptions($chart, options);

        // Update chart
        $chart.update();
      }
    }

    // Update options
    function updateOptions(elem) {
      var options = elem.data('update');
      var $target = $(elem.data('target'));
      var $chart = $target.data('chart');

      // Parse options
      parseOptions($chart, options);

      // Toggle ticks
      toggleTicks(elem, $chart);

      // Update chart
      $chart.update();
    }

    // Toggle ticks
    function toggleTicks(elem, $chart) {

      if (elem.data('prefix') !== undefined || elem.data('prefix') !== undefined) {
        var prefix = elem.data('prefix') ? elem.data('prefix') : '';
        var suffix = elem.data('suffix') ? elem.data('suffix') : '';

        // Update ticks
        $chart.options.scales.yAxes[0].ticks.callback = function(value) {
          if (!(value % 10)) {
            return prefix + value + suffix;
          }
        }

        // Update tooltips
        $chart.options.tooltips.callbacks.label = function(item, data) {
          var label = data.datasets[item.datasetIndex].label || '';
          var yLabel = item.yLabel;
          var content = '';

          if (data.datasets.length > 1) {
            content += '<span class="popover-body-label mr-auto">' + label + '</span>';
          }

          content += '<span class="popover-body-value">' + prefix + yLabel + suffix + '</span>';
          return content;
        }

      }
    }


    // Events

    // Parse global options
    if (window.Chart) {
      parseOptions(Chart, chartOptions());
    }

    // Toggle options
    $toggle.on({
      'change': function() {
        var $this = $(this);

        if ($this.is('[data-add]')) {
          toggleOptions($this);
        }
      },
      'click': function() {
        var $this = $(this);

        if ($this.is('[data-update]')) {
          updateOptions($this);
        }
      }
    });


    // Return

    return {
      colors: colors,
      fonts: fonts,
      mode: mode
    };

  })();

  'use strict';

  //
  // Sales chart
  //

  var SalesChart = (function() {

    // Variables

    var $chart = $('#chart-sales-dark');


    // Methods

    function init($chart) {

      var salesChart = new Chart($chart, {
        type: 'line',
        options: {
          scales: {
            yAxes: [{
              gridLines: {
                lineWidth: 1,
                color: Charts.colors.gray[900],
                zeroLineColor: Charts.colors.gray[900]
              },
              ticks: {
                callback: function(value) {
                  if (!(value % 1)) {
                    return value + 'km';
                  }
                  else {
                    return value + ' runs';
                  }
                }
              }
            }]
          },
          tooltips: {
            callbacks: {
              label: function(item, data) {
                var label = data.datasets[item.datasetIndex].label || '';
                var yLabel = item.yLabel;
                var content = '';

                if (data.datasets.length > 1) {
                  content += '<span class="popover-body-label mr-auto">' + label + '</span>';
                }

                content += '<span class="popover-body-value">$' + yLabel + 'k</span>';
                return content;
              }
            }
          }
        },
        data: {
          labels: {{ six_months_from_now|tojson }},
          datasets: [{
            label: 'Performance',
            data: {{ six_month_distances|tojson }}
          }]
        }
      });

      // Save to jQuery object

      $chart.data('chart', salesChart);

    };


    // Events

    if ($chart.length) {
      init($chart);
    }

  })();

  //
  // Bars chart
  //

  var BarsChart = (function() {

  //
  // Variables
  //

  var $chart = $('#chart-bars');


  //
  // Methods
  //

  // Init chart
  function initChart($chart) {

    // Create chart
    var ordersChart = new Chart($chart, {
      type: 'bar',
      data: {
        labels: {{ six_months_from_now|tojson }},
        datasets: [{
          label: 'calo',
          data: {{ six_month_calories|tojson }}
        }]
      }
    });

    // Save to jQuery object
    $chart.data('chart', ordersChart);
  }


  // Init chart
  if ($chart.length) {
    initChart($chart);
  }

  })();
</script>
{% endblock javascripts %}
